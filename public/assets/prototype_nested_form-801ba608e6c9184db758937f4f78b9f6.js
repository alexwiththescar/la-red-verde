document.observe("click",function(a,b){if(b=a.findElement("form a.add_nested_fields")){var c=b.readAttribute("data-association"),d=b.readAttribute("data-target"),e=$(b.readAttribute("data-blueprint-id")),f=e.readAttribute("data-blueprint"),g=(b.getOffsetParent(".fields").firstDescendant().readAttribute("name")||"").replace(new RegExp("[[a-z_]+]$"),"");if(g){var h=g.match(/[a-z_]+_attributes(?=\]\[(new_)?\d+\])/g)||[],j=g.match(/[0-9]+/g)||[];for(i=0;i<h.length;i++)j[i]&&(f=f.replace(new RegExp("(_"+h[i]+")_.+?_","g"),"$1_"+j[i]+"_"),f=f.replace(new RegExp("(\\["+h[i]+"\\])\\[.+?\\]","g"),"$1["+j[i]+"]"))}var k=new RegExp("new_"+c,"g"),l=(new Date).getTime();f=f.replace(k,l);var m;return d?m=$$(d)[0].insert(f):m=b.insert({before:f}),m.fire("nested:fieldAdded",{field:m}),m.fire("nested:fieldAdded:"+c,{field:m}),!1}}),document.observe("click",function(a,b){if(b=a.findElement("form a.remove_nested_fields")){var c=b.previous(0),d=b.readAttribute("data-association");c&&(c.value="1");var e=b.up(".fields").hide();return e.fire("nested:fieldRemoved",{field:e}),e.fire("nested:fieldRemoved:"+d,{field:e}),!1}});