((function(){var a;a=function(){function a(a,b,c,d,e,f,g){this.name=a,this.baseRequestForFilter=b,this.baseLinkForShowAllRecords=c,this.linkForExport=d,this.parameterNameForQueryLoading=e,this.parameterNameForFocus=f,this.environment=g,this.filterDeclarations=new Array,this.checkIfJsFrameworkIsLoaded()}return a.prototype.checkIfJsFrameworkIsLoaded=function(){if(!jQuery)return alert("jQuery not loaded, WiceGrid cannot proceed!")},a.prototype.toString=function(){return"<WiceGridProcessor instance for grid '"+this.name+"'>"},a.prototype.process=function(a){return window.location=this.buildUrlWithParams(a)},a.prototype.setProcessTimer=function(a){var b;return this.timer&&(clearTimeout(this.timer),this.timer=null),b=this,this.timer=setTimeout(function(){return b.process(a)},1e3)},a.prototype.reloadPageForGivenGridState=function(a){var b;return b=this.gridStateToRequest(a),window.location=this.appendToUrl(this.baseLinkForShowAllRecords,b)},a.prototype.gridStateToRequest=function(a){return jQuery.map(a,function(a){return encodeURIComponent(a[0])+"="+encodeURIComponent(a[1])}).join("&")},a.prototype.appendToUrl=function(a,b){var c;return c=a.indexOf("?")!==-1?/[&\?]$/.exec(a)?"":"&":"?",a+c+b},a.prototype.buildUrlWithParams=function(a){var b,c,d,e=this;return d=new Array,jQuery.each(this.filterDeclarations,function(a,b){var c;c=e.readValuesAndFormQueryString(b.filterName,b.detached,b.templates,b.ids);if(c&&c!=="")return d.push(c)}),c=this.baseRequestForFilter,d.length!==0&&(b=d.join("&"),c=this.appendToUrl(c,b)),a&&(c=this.appendToUrl(c,this.parameterNameForFocus+a)),c},a.prototype.reset=function(){return window.location=this.baseRequestForFilter},a.prototype.exportToCsv=function(){return window.location=this.linkForExport},a.prototype.register=function(a){return this.filterDeclarations.push(a)},a.prototype.readValuesAndFormQueryString=function(a,b,c,d){var e,f,g,h,i,j,k,l,m,n;i=new Array;for(f=k=0,m=c.length-1;0<=m?k<=m:k>=m;f=0<=m?++k:--k){if($(d[f])===null)return this.environment==="development"&&(h='WiceGrid: Error reading state of filter "'+a+'". No DOM element with id "'+d[f]+'" found.',b&&(h+='You have declared "'+a+'" as a detached filter but have not output it anywhere in the template. Read documentation about detached filters.'),alert(h)),"";e=$("#"+d[f]),e[0]&&e[0].type==="checkbox"?e[0].checked&&(j=1):j=e.val();if(j instanceof Array)for(g=l=0,n=j.length-1;0<=n?l<=n:l>=n;g=0<=n?++l:--l)j[g]&&j[g]!==""&&i.push(c[f]+encodeURIComponent(j[g]));else j&&j!==""&&i.push(c[f]+encodeURIComponent(j))}return i.join("&")},a,a}(),a._version="3.2",window.WiceGridProcessor=a})).call(this),function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n;jQuery(function(){return c()}),c=function(){return $(".wice-grid-container").each(function(b,c){var d,i,j,o,p,q,r,s,t;o=c.id,d=$(".wg-data",c),q=d.data("processor-initializer-arguments"),j=d.data("filter-declarations"),a(d.data("foc")),p=new WiceGridProcessor(o,q[0],q[1],q[2],q[3],q[4],q[5]),r=function(a){return p.register({filterName:a.filterName,detached:a.detached,templates:a.declaration.templates,ids:a.declaration.ids})};for(s=0,t=j.length;s<t;s++)i=j[s],r(i);return window[o]=p,h(),n(c,p),g(c,p),k(c),m(c,p),l(c),e(c,p),f(c)}),d(),j(),i()},h=function(){var a;return $(".wice-grid-container input.check-for-datepicker[type=hidden], .wg-detached-filter input.check-for-datepicker[type=hidden]").length!==0&&($.datepicker||alert("Seems like you do not have jQuery datepicker (http://jqueryui.com/demos/datepicker/)\ninstalled. Either install it or set Wice::Defaults::HELPER_STYLE to :standard in\nwice_grid_config.rb in order to use standard Rails date helpers")),(a=$(".wice-grid-container input[type=hidden], .wg-detached-filter input[type=hidden]").data("locale"))&&$.datepicker.setDefaults($.datepicker.regional[a]),$(".wice-grid-container .date-label, .wg-detached-filter .date-label").each(function(a,b){var c,d,e;return c=$("#"+$(b).data("dom-id")),d=c.data("close-calendar-event-name"),$(b).click(function(a){return $(this).html(""),c.val(""),d&&c.trigger(d),a.preventDefault(),!1}),e=this,c.datepicker({firstDay:1,showOn:"button",dateFormat:c.data("date-format"),buttonImage:c.data("button-image"),buttonImageOnly:!0,buttonText:c.data("button-text"),changeMonth:!0,changeYear:!0,onSelect:function(a,b){$(e).html(a);if(d)return c.trigger(d)}})})},k=function(a){var b,c,d;return c=".wg-hide-filter",d=".wg-show-filter",b=".wg-filter-row",$(c,a).click(function(){return $(this).hide(),$(d,a).show(),$(b,a).hide()}),$(d,a).click(function(){return $(this).hide(),$(c,a).show(),$(b,a).show()})},g=function(a,b){return $(".export-to-csv-button",a).click(function(){return b.exportToCsv()})},n=function(a,b){return $(".submit",a).click(function(){return b.process()}),$(".reset",a).click(function(){return b.reset()}),$(".wg-filter-row input[type=text]",a).keydown(function(a){if(a.keyCode===13)return a.preventDefault(),b.process()})},a=function(a){var b,c;c=$("#"+a);if(b=c[0])return b.value=b.value,b.focus()},e=function(a,b){return $("select.auto-reload",a).change(function(){return b.process()}),$("input.auto-reload",a).keyup(function(){return b.setProcessTimer(this.id)}),$("input.negation-checkbox.auto-reload",a).click(function(){return b.process()}),$(document).bind("wg:calendarChanged_"+b.name,function(){return b.process()})},d=function(){return $(".wg-detached-filter").each(function(a,c){var d;d=b(c);if(d)return $("select.auto-reload",c).change(function(){return d.process()}),$("input.auto-reload",c).keyup(function(){return d.setProcessTimer(this.id)}),$("input.negation-checkbox.auto-reload",c).click(function(){return d.process()})})},m=function(a,b){return $(".wg-show-all-link, .wg-back-to-pagination-link",a).click(function(a){var c,d,e;a.preventDefault(),d=$(this).data("grid-state"),c=$(this).data("confim-message"),e=function(){return b.reloadPageForGivenGridState(d)};if(!c)return e();if(confirm(c))return e()})},l=function(a){return $(".expand-multi-select-icon",a).click(function(){return $(this).prev().each(function(a,b){return b.multiple=!0}),$(this).next().show(),$(this).hide()}),$(".collapse-multi-select-icon",a).click(function(){return $(this).prev().prev().each(function(a,b){return b.multiple=!1}),$(this).prev().show(),$(this).hide()})},f=function(a){return $(".select-all",a).click(function(){return $(".sel input",a).prop("checked",!0)}),$(".deselect-all",a).click(function(){return $(".sel input",a).prop("checked",!1)})},b=function(a){var b;return b=$(a).data("grid-name"),b?window[b]:null},i=function(){return $(".wg-external-csv-export-button").each(function(a,c){var d;d=b(c);if(d)return $(c).click(function(a){return d.exportToCsv()})})},j=function(){return $(".wg-external-submit-button").each(function(a,c){var d;d=b(c);if(d)return $(c).click(function(a){return d.process(),a.preventDefault(),!1})}),$(".wg-external-reset-button").each(function(a,c){var d;d=b(c);if(d)return $(c).click(function(a){return d.reset(),a.preventDefault(),!1})}),$(".wg-detached-filter").each(function(a,c){var d;d=b(c);if(d)return $("input[type=text]",this).keydown(function(a){if(a.keyCode===13)return d.process(),a.preventDefault(),!1})})},window.getGridProcessorForElement=b}.call(this),function(){var a,b,c,d,e;jQuery(function(){return e()}),e=function(){return $(".wice-grid-save-query-field").keydown(function(a){if(a.keyCode===13)return d($(this).next(),a)}),$(".wice-grid-save-query-button").click(function(a){return d(this,a)}),$(".wice-grid-delete-query").click(function(b){return a(this,b)}),$(".wice-grid-query-load-link").click(function(a){return b(this,a)})},b=function(a,b){var c,d,e;if(c=window.getGridProcessorForElement(a))d=$(a).data("query-id"),e=c.appendToUrl(c.buildUrlWithParams(),c.parameterNameForQueryLoading+encodeURIComponent(d)),window.location=e;return b.preventDefault(),b.stopPropagation(),!1},a=function(a,b){var d,e,f;return d=$(a).data("wg-confirm"),f=d?function(){return confirm(d)}:function(){return!0},f()&&(e=window.getGridProcessorForElement(a))&&jQuery.ajax({url:$(a).attr("href"),async:!0,dataType:"json",success:function(a,b,d){return c(a,e.name)},type:"POST"}),b.preventDefault(),b.stopPropagation(),!1},d=function(a,b){var d,e,f,g,h,i,j,k;if(e=window.getGridProcessorForElement(a))return k=$(a),d=k.data("base-path-to-query-controller"),f=k.data("parameters"),h=k.data("ids"),g=k.prev(),h instanceof Array&&h.each(function(a){return f.push(["extra["+a+"]",$("#"+a).val()])}),i=g.val(),j=e.gridStateToRequest(f),jQuery.ajax({url:d,async:!0,data:j+"&query_name="+encodeURIComponent(i),dataType:"json",success:function(a,b,d){return c(a,e.name,i,g)},type:"POST"}),b.preventDefault(),!1},c=function(c,d,e,f){var g,h,i,j,k;return j="#"+d+"_notification_messages",h="#"+d+"_title",k="#"+d+"_query_list",e&&f.val(""),(g=c.error_messages)?$(j).text(errorExplanation):((i=c.notification_messages)&&$(j).text(i),e&&$(h).html("<h3>"+e+"</h3>"),$(k).replaceWith(c.query_list),$(k).effect("highlight"),$(".wice-grid-delete-query",$(k)).click(function(b){return a(this,b)}),$(".wice-grid-query-load-link",$(k)).click(function(a){return b(this,a)}))}}.call(this);